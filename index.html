<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Armored Type Safety with Iron</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/theme/black.css" id="theme">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//plugin/highlight/monokai.css">
  <link rel="stylesheet" href="theme.css"/>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Armored Type Safety with Iron</h1>
  <p class="subtitle">Scala Matters, Paris</p>
  <p class="date">November 28th, 2023</p>
</section>

<section>
<section id="who-are-we" class="title-slide slide level1">
<h1>Who are we?</h1>

</section>
<section id="section" class="slide level2">
<h2></h2>
<div class="columns">
<div class="column">
<figure>
<img data-src="images/vbergeron.png" class="img_right portrait"
alt="Valentin Bergeron" />
<figcaption aria-hidden="true">Valentin Bergeron</figcaption>
</figure>
<ul>
<li>Engineering Team Lead</li>
<li>Backend Blockchain</li>
</ul>
<p><img data-src="images/ledger-logo.svg" class="ledger" /></p>
</div><div class="column">
<figure>
<img data-src="images/rlemaitre.jpeg" class="img_right portrait"
alt="Rapha√´l Lemaitre" />
<figcaption aria-hidden="true">Rapha√´l Lemaitre</figcaption>
</figure>
<ul>
<li>Senior Staff Software Engineer</li>
<li>Backend Blockchain</li>
</ul>
<p><img data-src="images/ledger-logo.svg" class="ledger" /></p>
</div>
</div>
</section></section>
<section>
<section id="story-time" class="title-slide slide level1">
<h1>Story time</h1>

</section>
<section id="section-1" class="slide level2">
<h2></h2>
<p>Suppose you find this code in your codebase</p>
<pre data-id="code"><code class="scala" data-line-numbers="">case class IBAN(
  countryCode: String,
  checkDigits: String,
  bankCode: String,
  branchCode: String,
  accountNumber: String,
  nationalCheckDigit: String
)</code></pre>
</section>
<section id="section-2" class="slide level2" data-auto-animate="">
<h2 data-auto-animate=""></h2>
<p>This looks good</p>
<pre data-id="code"><code class="scala" data-line-numbers="">val iban = IBAN(
  "FR",
  "14",
  "20041",
  "01005",
  "0500013M026",
  "06"
)</code></pre>
</section>
<section id="section-3" class="slide level2" data-auto-animate="">
<h2 data-auto-animate=""></h2>
<p>Until you find something like this</p>
<pre data-id="code"><code class="scala" data-line-numbers="">val shuffled = IBAN(
  "0500013M026",
  "FR",
  "06",
  "14",
  "20041",
  "01005"
)</code></pre>
<p><span style="font-size: 400%;">üßë‚Äçüíª</span></p>
</section>
<section id="section-4" class="slide level2" data-auto-animate="">
<h2 data-auto-animate=""></h2>
<p>Until you find something like this</p>
<pre data-id="code"><code class="scala" data-line-numbers="">val shuffled = IBAN(
  "0500013M026",
  "FR",
  "06",
  "14",
  "20041",
  "01005"
)</code></pre>
</section>
<section id="section-5" class="slide level2" data-auto-animate="">
<h2 data-auto-animate=""></h2>
<p>So, you try this</p>
<pre data-id="code"><code class="scala" data-line-numbers="">val wtf = IBAN(
  "üá´üá∑",
  "‚úÖ",
  "üè¶",
  "üå≥",
  "üßæ",
  "ü§°"
)</code></pre>
</section>
<section id="section-6" class="slide level2" data-auto-animate="">
<h2 data-auto-animate=""></h2>
<p>So, you try this</p>
<pre data-id="code"><code class="scala" data-line-numbers="">val wtf = IBAN(
  "üá´üá∑",
  "‚úÖ",
  "üè¶",
  "üå≥",
  "üßæ",
  "ü§°"
)</code></pre>
</section></section>
<section>
<section id="how-can-we-do-better" class="title-slide slide level1">
<h1>How can we do better?</h1>

</section>
<section id="maybe-with-type-aliases" class="slide level2">
<h2>Maybe with Type aliases?</h2>
</section>
<section id="section-7" class="slide level2">
<h2></h2>
<pre data-id="code"><code class="scala" data-line-numbers="">type CountryCode = String
type CheckDigits = String
type BankCode = String
type BranchCode = String
type AccountNumber = String
type NationalCheckDigit = String

case class IBAN(
  countryCode: CountryCode,
  checkDigits: CheckDigits,
  bankCode: BankCode,
  branchCode: BranchCode,
  accountNumber: AccountNumber,
  nationalCheckDigit: NationalCheckDigit
)</code></pre>
<aside class="notes">
<p>Pros</p>
<ul>
<li>Legibility</li>
</ul>
<p>Cons</p>
<ul>
<li>Substitutions are possible</li>
<li>No validation</li>
</ul>
</aside>
</section>
<section id="so-maybe-with-value-classes" class="slide level2">
<h2>So, maybe with value classes?</h2>
</section>
<section id="section-8" class="slide level2">
<h2></h2>
<pre data-id="code"><code class="scala" data-line-numbers="">case class CountryCode(value: String) extends AnyVal

case class CheckDigits(value: String) extends AnyVal

case class BankCode(value: String) extends AnyVal

case class BranchCode(value: String) extends AnyVal

case class AccountNumber(value: String) extends AnyVal

case class NationalCheckDigit(value: String) extends AnyVal</code></pre>
</section>
<section id="section-9" class="slide level2" data-auto-animate="">
<h2 data-auto-animate=""></h2>
<p>This looks good</p>
<pre data-id="code"><code class="scala" data-line-numbers="">val iban = IBAN(
  CountryCode("FR"),
  CheckDigits("14"),
  BankCode("20041"),
  BranchCode("01005"),
  AccountNumber("0500013M026"),
  NationalCheckDigit("06")
)</code></pre>
</section>
<section id="section-10" class="slide level2" data-auto-animate="">
<h2 data-auto-animate=""></h2>
<p>And this cannot compile anymore</p>
<pre data-id="code"><code class="scala" data-line-numbers="">val shuffled = IBAN(
  AccountNumber("0500013M026"),
  CountryCode("FR"),
  NationalCheckDigit("06"),
  CheckDigits("14"),
  BankCode("20041"),
  BranchCode("01005")
)</code></pre>
</section>
<section id="section-11" class="slide level2" data-auto-animate="">
<h2 data-auto-animate=""></h2>
<p>But this one still compiles</p>
<pre data-id="code"><code class="scala" data-line-numbers="">val wtf = IBAN(
  CountryCode("üá´üá∑"),
  CheckDigits("‚úÖ"),
  BankCode("üè¶"),
  BranchCode("üå≥"),
  AccountNumber("üßæ"),
  NationalCheckDigit("ü§°")
)</code></pre>
</section>
<section id="lets-add-validation" class="slide level2">
<h2>Let‚Äôs add validation</h2>
</section>
<section id="section-12" class="slide level2">
<h2></h2>
<pre ><code class="scala">case class CountryCode(value: String) extends AnyVal:
  require(value.length == 2, "Country code must be 2 characters")

case class CheckDigits(value: String) extends AnyVal:
  require(value.length == 2, "Check digits must be 2 characters")

case class BankCode(value: String) extends AnyVal:
  require(value.length == 5, "Bank code must be 5 characters")

case class BranchCode(value: String) extends AnyVal:
  require(value.length == 5, "Branch code must be 5 characters")

case class AccountNumber(value: String) extends AnyVal:
  require(value.length == 11, "Account number must be 11 characters")

case class NationalCheckDigit(value: String) extends AnyVal:
  require(value.length == 2, "National check digit must be 2 characters")</code></pre>
</section>
<section id="lets-validate-without-crashing" class="slide level2">
<h2>Let‚Äôs validate without crashing</h2>
</section>
<section id="section-13" class="slide level2">
<h2></h2>
<pre ><code class="scala">case class FormatError(reason: String) 
   extends Exception(reason), NoStackTrace</code></pre>
</section>
<section id="section-14" class="slide level2">
<h2></h2>
<pre data-id="either-code"><code class="scala" data-line-numbers="">case class CountryCode(value: String) extends AnyVal
object CountryCode:
  def parse(input: String): Either[FormatError, CountryCode] =
    Either.cond(input.length == 2, CountryCode(input), 
      FormatError("Country code must be 2 characters"))

case class CheckDigits(value: String) extends AnyVal
object CheckDigits:
  def parse(input: String): Either[FormatError, CheckDigits] =
    Either.cond(input.length == 2, CheckDigits(input), 
      FormatError("Check digits must be 2 characters"))

case class BankCode(value: String) extends AnyVal
object BankCode:
  def parse(input: String): Either[FormatError, BankCode] =
    Either.cond(input.length == 5, BankCode(input),
      FormatError("Bank code must be 5 characters"))</code></pre>
</section>
<section id="section-15" class="slide level2">
<h2></h2>
<pre data-id="either-code"><code class="scala" data-line-numbers="3,9,15|4-5,10-11,16-17">case class CountryCode(value: String) extends AnyVal
object CountryCode:
  def parse(input: String): Either[FormatError, CountryCode] =
    Either.cond(input.length == 2, CountryCode(input), 
      FormatError("Country code must be 2 characters"))

case class CheckDigits(value: String) extends AnyVal
object CheckDigits:
  def parse(input: String): Either[FormatError, CheckDigits] =
    Either.cond(input.length == 2, CheckDigits(input), 
      FormatError("Check digits must be 2 characters"))

case class BankCode(value: String) extends AnyVal
object BankCode:
  def parse(input: String): Either[FormatError, BankCode] =
    Either.cond(input.length == 5, BankCode(input),
      FormatError("Bank code must be 5 characters"))</code></pre>
</section>
<section id="section-16" class="slide level2">
<h2></h2>
<pre data-id="either-code"><code class="scala" data-line-numbers="">case class BranchCode(value: String) extends AnyVal
object BranchCode:
  def parse(input: String): Either[FormatError, BranchCode] =
    Either.cond(input.length == 5, BranchCode(input), 
      FormatError("Branch code must be 5 characters"))

case class AccountNumber(value: String) extends AnyVal
object AccountNumber:
  def parse(input: String): Either[FormatError, AccountNumber] =
    Either.cond(input.length == 11, AccountNumber(input), 
      FormatError("Account number must be 11 characters"))

case class NationalCheckDigit(value: String) extends AnyVal
object NationalCheckDigits:
  def parse(input: String): Either[FormatError, NationalCheckDigits] =
    Either.cond(input.length == 2, NationalCheckDigits(input), 
      FormatError("Notional check digits must be 2 characters"))</code></pre>
</section>
<section id="section-17" class="slide level2">
<h2></h2>
<pre data-id="either-code"><code class="scala" data-line-numbers="3,9,15|4-5,10-11,16-17">case class BranchCode(value: String) extends AnyVal
object BranchCode:
  def parse(input: String): Either[FormatError, BranchCode] =
    Either.cond(input.length == 5, BranchCode(input), 
      FormatError("Branch code must be 5 characters"))

case class AccountNumber(value: String) extends AnyVal
object AccountNumber:
  def parse(input: String): Either[FormatError, AccountNumber] =
    Either.cond(input.length == 11, AccountNumber(input), 
      FormatError("Account number must be 11 characters"))

case class NationalCheckDigit(value: String) extends AnyVal
object NationalCheckDigits:
  def parse(input: String): Either[FormatError, NationalCheckDigits] =
    Either.cond(input.length == 2, NationalCheckDigits(input), 
      FormatError("Notional check digits must be 2 characters"))</code></pre>
</section>
<section id="section-18" class="slide level2">
<h2></h2>
<pre data-id="opaque-types-code"><code class="scala" data-line-numbers="">opaque type BranchCode &lt;: String = String
object BranchCode:

  inline def wrap(input: String): BranchCode = input

  extension (value: BranchCode) inline def unwrap: String = value

  def parse(input: String): Either[FormatError, BranchCode] =
    Either.cond(input.length == 5, wrap(input), 
      FormatError("Branch code must be 5 characters"))</code></pre>
</section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 12%" />
<col style="width: 12%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 20%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Legible</th>
<th style="text-align: center;">Ordered</th>
<th style="text-align: center;">Valid</th>
<th style="text-align: center;">Pure</th>
<th style="text-align: center;">Performance</th>
<th style="text-align: center;">Concise</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Raw Classes</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="even">
<td style="text-align: center;">Type Aliases</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Value Classes</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="even">
<td style="text-align: center;">VC + Require</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="odd">
<td style="text-align: center;">VC + Either</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="even">
<td style="text-align: center;">Opaque types</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
</tr>
</tbody>
</table>
</section></section>
<section id="something-smarter-and-with-less-boilerplate"
class="title-slide slide level1">
<h1>Something smarter and with less boilerplate?</h1>

</section>

<section>
<section id="section-19" class="title-slide slide level1">
<h1></h1>
<p><img data-src="images/iron-logo.png" /></p>
</section>
<section id="what-is-iron" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What is Iron?</h2>
</section>
<section id="what-is-iron-1" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What is Iron?</h2>
<p>Composable type constraint library</p>
<p>Created in Scala 3 <span class="devicon-scala-plain colored"></span>
by Rapha√´l Fromentin</p>
<p>It enables binding constraints to a specific type</p>
</section>
<section id="what-is-iron-2" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What is Iron?</h2>
<p>Composable type <strong>constraint</strong> library</p>
<pre data-id="code"><code class="scala" data-line-numbers="1|3-7">final class Positive

import io.github.iltotore.iron.*

given Constraint[Int, Positive] with
  override inline def test(value: Int): Boolean = value &gt; 0
  override inline def message: String = "Should be strictly positive"




//</code></pre>
<div class="faded">
<p>Created in Scala 3 <span class="devicon-scala-plain colored"></span>
by Rapha√´l Fromentin</p>
<p>It enables binding constraints to a specific type</p>
</div>
</section>
<section id="what-is-iron-3" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What is Iron?</h2>
<p>Composable <strong>type constraint</strong> library</p>
<pre data-id="code"><code class="scala" data-line-numbers="9">final class Positive

import io.github.iltotore.iron.*

given Constraint[Int, Positive] with
  override inline def test(value: Int): Boolean = value &gt; 0
  override inline def message: String = "Should be strictly positive"

val x: Int :| Positive = 1


//</code></pre>
<div class="faded">
<p>Created in Scala 3 <span class="devicon-scala-plain colored"></span>
by Rapha√´l Fromentin</p>
<p>It enables binding constraints to a specific type</p>
</div>
</section>
<section id="what-is-iron-4" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What is Iron?</h2>
<p>Composable <strong>type constraint</strong> library</p>
<pre data-id="code"><code class="scala" data-line-numbers="10-11">final class Positive

import io.github.iltotore.iron.*

given Constraint[Int, Positive] with
  override inline def test(value: Int): Boolean = value &gt; 0
  override inline def message: String = "Should be strictly positive"

val x: Int :| Positive = 1
//Compile-time error: Should be strictly positive
val y: Int :| Positive = -1 
//</code></pre>
<div class="faded">
<p>Created in Scala 3 <span class="devicon-scala-plain colored"></span>
by Rapha√´l Fromentin</p>
<p>It enables binding constraints to a specific type</p>
</div>
</section>
<section id="what-is-iron-5" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What is Iron?</h2>
<p><strong>Composable type constraint</strong> library</p>
<pre data-id="code"><code class="scala" data-line-numbers="7">final class Positive
// ...
val x: Int :| Positive = 1
//Compile-time error: Should be strictly positive
val y: Int :| Positive = -1 

val foo: Int :| (Positive & Less[42]) = 1




//</code></pre>
<div class="faded">
<p>Created in Scala 3 <span class="devicon-scala-plain colored"></span>
by Rapha√´l Fromentin</p>
<p>It enables binding constraints to a specific type</p>
</div>
</section>
<section id="what-is-iron-6" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What is Iron?</h2>
<p><strong>Composable type constraint</strong> library</p>
<pre data-id="code"><code class="scala" data-line-numbers="8-9">final class Positive
// ...
val x: Int :| Positive = 1
//Compile-time error: Should be strictly positive
val y: Int :| Positive = -1 

val foo: Int :| (Positive & Less[42]) = 1
//Compile-time error: Should be strictly positive
val bar: Int :| (Positive & Less[42]) = -1 


//</code></pre>
<div class="faded">
<p>Created in Scala 3 <span class="devicon-scala-plain colored"></span>
by Rapha√´l Fromentin</p>
<p>It enables binding constraints to a specific type</p>
</div>
</section>
<section id="what-is-iron-7" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What is Iron?</h2>
<p><strong>Composable type constraint</strong> library</p>
<pre data-id="code"><code class="scala" data-line-numbers="10-11">final class Positive
// ...
val x: Int :| Positive = 1
//Compile-time error: Should be strictly positive
val y: Int :| Positive = -1 

val foo: Int :| (Positive & Less[42]) = 1
//Compile-time error: Should be strictly positive
val bar: Int :| (Positive & Less[42]) = -1 
//Compile-time error: Should be less than 42
val baz: Int :| (Positive & Less[42]) = 123
//</code></pre>
<div class="faded">
<p>Created in Scala 3 <span class="devicon-scala-plain colored"></span>
by Rapha√´l Fromentin</p>
<p>It enables binding constraints to a specific type</p>
</div>
</section>
<section id="validation" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Validation</h2>
</section>
<section id="validation-1" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Validation</h2>
<pre data-id="code"><code class="scala" data-line-numbers="">val value: Int = ???
val x: Int :| Greater[0] = value</code></pre>
</section>
<section id="validation-2" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Validation</h2>
<pre data-id="code"><code class="scala" data-line-numbers="">inline val value = 2
val x: Int :| Greater[0] = value</code></pre>
</section>
<section id="what-if-the-value-is-known-at-runtime" class="slide level2"
data-auto-animate="">
<h2 data-auto-animate="">What if the value is known at runtime?</h2>
<pre data-id="code"><code class="scala" data-line-numbers="">val value = ???
val x: Int :| Greater[0] = value.refine</code></pre>
<aside class="notes">
<p>Imperative</p>
<p>Illegal argument exception</p>
</aside>
</section>
<section id="what-if-the-value-is-known-at-runtime-1"
class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">What if the value is known at runtime?</h2>
<pre data-id="code"><code class="scala" data-line-numbers="">def createIBAN(  countryCode: String,
  checkDigits: String,
  bankCode: String,
  branchCode: String,
  accountNumber: String,
  nationalCheckDigit: String
): Either[String, User] =
  for
    ctr &lt;- countryCode.refineEither[Alphanumeric & Length[Equals[ 2]]]
    chk &lt;- countryCode.refineEither[Alphanumeric & Length[Equals[ 2]]]
    ban &lt;- countryCode.refineEither[Alphanumeric & Length[Equals[ 5]]]
    bra &lt;- countryCode.refineEither[Alphanumeric & Length[Equals[ 5]]]
    acc &lt;- countryCode.refineEither[Alphanumeric & Length[Equals[11]]]
    nck &lt;- countryCode.refineEither[Alphanumeric & Length[Equals[ 2]]]
  yield IBAN(ctr, chk, ban, bra, acc, nck)</code></pre>
<aside class="notes">
<p>Functional</p>
</aside>
</section>
<section id="constrained-opaque-types" class="slide level2">
<h2>Constrained Opaque Types</h2>
<p>No implementation leak</p>
<pre ><code class="scala">opaque type Positive &lt;: Int  = Int :| Greater[0]

object Positive extends RefinedTypeOps[Int, Greater[0], Positive]</code></pre>
</section>
<section id="constrained-opaque-types-1" class="slide level2">
<h2>Constrained Opaque Types</h2>
<p>Constraint factorization</p>
<pre ><code class="scala">private type SatsConstraint = 
  GreaterEqual[0] & LessEqual[100000000 * 21000000]

opaque type Sats &lt;: Long = Long :| SatsConstraint

object Sats extends RefinedTypeOps[Long, SatsConstraint, Sats]</code></pre>
</section>
<section id="feedback-loop" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Feedback loop</h2>
<p>How much time do we need to find a bug?</p>
</section>
<section id="feedback-loop-1" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Feedback loop</h2>
<div class="r-stack">
<div class="circle" data-id="box1"
style="background: #ca3c66; width: 700px; height: 700px;">

</div>
</div>
<p>In production</p>
</section>
<section id="feedback-loop-2" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Feedback loop</h2>
<div class="r-stack">
<div class="circle" data-id="box1"
style="border: 4px dotted #ca3c66; background: transparent; width: 700px; height: 700px;">

</div>
<div class="circle" data-id="box2"
style="background: #db6a8f; width: 600px; height: 600px;">

</div>
</div>
<p>In staging</p>
</section>
<section id="feedback-loop-3" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Feedback loop</h2>
<div class="r-stack">
<div class="circle faded" data-id="box1"
style="border: 4px dotted #ca3c66; background: transparent; width: 700px; height: 700px;">

</div>
<div class="circle faded" data-id="box2"
style="border: 4px dotted #db6a8f; background: transparent; width: 600px; height: 600px;">

</div>
<div class="circle" data-id="box3"
style="background: #e8aabe; width: 300px; height: 300px;">

</div>
</div>
<p>Integration tests</p>
</section>
<section id="feedback-loop-4" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Feedback loop</h2>
<div class="r-stack">
<div class="circle faded" data-id="box1"
style="border: 4px dotted #ca3c66; background: transparent; width: 700px; height: 700px;">

</div>
<div class="circle faded" data-id="box2"
style="border: 4px dotted #db6a8f; background: transparent; width: 600px; height: 600px;">

</div>
<div class="circle faded" data-id="box3"
style="border: 4px dotted #e8aabe; background: transparent; width: 300px; height: 300px;">

</div>
<div class="circle" data-id="box4"
style="background: #a7e0e0; width: 200px; height: 200px;">

</div>
</div>
<p>Unit tests</p>
</section>
<section id="feedback-loop-5" class="slide level2" data-auto-animate="">
<h2 data-auto-animate="">Feedback loop</h2>
<div class="r-stack">
<div class="circle" data-id="box1"
style="border: 4px dotted #ca3c66; background: transparent; width: 700px; height: 700px;">

</div>
<div class="circle" data-id="box2"
style="border: 4px dotted #db6a8f; background: transparent; width: 600px; height: 600px;">

</div>
<div class="circle" data-id="box3"
style="border: 4px dotted #e8aabe; background: transparent; width: 300px; height: 300px;">

</div>
<div class="circle" data-id="box4"
style="border: 4px dotted #a7e0e0; background: transparent; width: 200px; height: 200px;">

</div>
<div class="circle" data-id="box5"
style="background: #4aa3a2; width: 50px; height: 50px;">

</div>
</div>
<p>Compilation time</p>
</section>
<section id="summary-1" class="slide level2">
<h2>Summary</h2>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 17%" />
<col style="width: 11%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Legible</th>
<th style="text-align: center;">Ordered</th>
<th style="text-align: center;">Valid</th>
<th style="text-align: center;">Pure</th>
<th style="text-align: center;">Performance</th>
<th style="text-align: center;">Concise</th>
<th style="text-align: center;">Compiles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Raw Classes</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="even">
<td style="text-align: center;">Type Aliases</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Value Classes</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="even">
<td style="text-align: center;">VC + Require</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="odd">
<td style="text-align: center;">VC + Either</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="even">
<td style="text-align: center;">Opaque types</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Iron</strong></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
</tbody>
</table>
</section></section>
<section>
<section id="iron-ecosystem" class="title-slide slide level1">
<h1>Iron <img data-src="images/scalalove-logo.svg" class="logo" />
Ecosystem</h1>

</section>
<section id="refinement-outputs" class="slide level2">
<h2>Refinement outputs</h2>
<ul>
<li>Cats (<code>Validated</code>, <code>Either</code> +
<code>Parallel[F]</code>)</li>
<li>ZIO (<code>Validation</code>)</li>
</ul>
</section>
<section id="typeclasses-instances" class="slide level2">
<h2>Typeclasses instances</h2>
<ul>
<li><em>Tapir</em></li>
<li>JSON (<em>Circe</em>, <em>Jsoniter</em>, <em>ZIO-JSON</em>)</li>
<li>Databases (<em>doobie</em>, <em>skunk</em>)</li>
<li><em>Ciris</em></li>
<li><em>Scalacheck</em></li>
</ul>
</section>
<section id="integration-exemples" class="slide level2">
<h2>Integration Exemples</h2>
<pre ><code class="scala">final case class Tag(name: Tag.Name, value: Tag.Value)

object Tag:

  private type NameConstraint = Not[Empty] & MaxLength[128]
  opaque type Name &lt;: String  = String :| NameConstraint

  object Name extends RefinedTypeOps[String, NameConstraint, Name]

  private type ValueConstraint = Not[Empty] & MaxLength[512]
  opaque type Value &lt;: String  = String :| ValueConstraint

  object Value extends RefinedTypeOps[String, ValueConstraint, Value]</code></pre>
</section>
<section id="integration-exemples-tapir" class="slide level2">
<h2>Integration Exemples : Tapir</h2>
<pre ><code class="scala">val getLatest = base
  .name("Get latest account addresses")
  .in(query[Option[Tag]]("tag"))
  .get
  .in("latest")
  .out(jsonBody[Option[AddressView]])</code></pre>
</section>
<section id="integration-exemples-doobie" class="slide level2">
<h2>Integration Exemples : Doobie</h2>
<pre ><code class="scala">def getLatestByTag(account: AccountId, name: Tag.Name, value: Tag.Value): ConnectionIO[Option[Position]] =
  sql"""
  select
    account_id,
    address,
    coalesce(
      (select jsonb_object_agg(tag_name, tag_value order by tag_name) 
       from position_tags pt where p.position_id = pt.position_id),
      '{}'::jsonb),
    sync_status
  from positions p left join position_tags pt using (position_id)
  where account_id = $account
    and tag_name   = $name
    and tag_value  = $value
  order by position_id desc limit 1
  """.query[Position].option</code></pre>
</section>
<section id="making-an-integration-doobie" class="slide level2">
<h2>Making an integration : Doobie</h2>
<pre ><code class="scala">  inline given [A, C]
    (using inline meta: Meta[A])
    (using Constraint[A, C], Show[A]): Meta[A :| C] =
      meta.tiemap[A :| C](_.refineEither)(identity)

  inline given [T]
    (using m: RefinedTypeOps.Mirror[T], ev: Meta[m.IronType]): Meta[T] =
      ev.asInstanceOf[Meta[T]]</code></pre>
</section></section>
<section id="takeaways" class="title-slide slide level1">
<h1>Takeaways</h1>
<blockquote>
<p>Making illegal states unrepresentable</p>
</blockquote>
<p><a href="https://blog.janestreet.com/effective-ml-revisited/">Yaron
Minsky</a></p>
</section>

<section id="takeaways-1" class="title-slide slide level1">
<h1>Takeaways</h1>
<p>Scala 3 type system is incredibly powerful</p>
</section>

<section id="takeaways-2" class="title-slide slide level1">
<h1>Takeaways</h1>
<p>Noticeably increased the reliability of our code</p>
</section>

<section id="thank-you" class="title-slide slide level1">
<h1>Thank you!</h1>
<figure>
<img data-src="images/slides-url.svg" class="r-stretch"
alt="Slides available at https://iron.rlemaitre.com" />
<figcaption aria-hidden="true">Slides available at
https://iron.rlemaitre.com</figcaption>
</figure>
</section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4//dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4//plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/zoom/zoom.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/highlight/highlight.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,
        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,
        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',
        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',
        // Display a presentation progress bar
        progress: true,
        // Display the page number of the current slide
        slideNumber: 'c',
        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,
        // Push each slide change to the browser history
        history: true,
        // Enable keyboard shortcuts for navigation
        keyboard: {13: 'next', 33: 'prev', 34: 'next'},
        // Enable the slide overview mode
        overview: true,
        // Vertical centering of slides
        center: true,
        // Enables touch navigation on devices with touch input
        touch: true,
        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',
        // Turns fragments on and off globally
        fragments: true,
        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,
        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,
        // Global override for autoplaying embedded media (video/audio/iframe)
        // - null: Media will only autoplay if data-autoplay is present
        // - true: All media will autoplay, regardless of individual setting
        // - false: No media will autoplay, regardless of individual setting
        autoPlayMedia: null,
        // Global override for preloading lazy-loaded iframes
        // - null: Iframes with data-src AND data-preload will be loaded when within
        //   the viewDistance, iframes with only data-src will be loaded when visible
        // - true: All iframes with data-src will be loaded when within the viewDistance
        // - false: All iframes with data-src will be loaded only when visible
        preloadIframes: null,
        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,
        // Stop auto-sliding after user input
        autoSlideStoppable: true,
        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,
        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,
        // Hide cursor if inactive
        hideInactiveCursor: true,
        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,
        // Transition style
        transition: 'none', // none/fade/slide/convex/concave/zoom
        // Transition speed
        transitionSpeed: 'default', // default/fast/slow
        // Transition style for full page slide backgrounds
        backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom
        // Number of slides away from the current that are visible
        viewDistance: 3,
        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1920,
        height: 1080,
        // The display mode that will be used to show slides
        display: 'block',

        // reveal.js plugins
        plugins: [
          RevealHighlight,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
